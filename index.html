<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S≈•ahovanie Mobiln√Ωch a PC Hier - NEXUS Pro</title>
    <!-- Web Ikona (Favicon) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ö°</text></svg>">
    
    <!-- Naƒç√≠tanie Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Konfigur√°cia p√≠sma a farieb pre modern√Ω tmav√Ω, futuristick√Ω vzhƒæad (Cyberpunk Ne√≥n) */
        :root {
            --primary-color: #6366f1; /* Indigo/Violet */
            --accent-color: #34d399; /* Emerald/Mint Green */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d0d1a; /* Extr√©mne tmav√© pozadie (takmer ƒçierne) */
            color: #e5e7eb; /* Svetlej≈°√≠ text */
        }
        
        /* Navigaƒçn√Ω Panel - Pridan√Ω jemn√Ω gradient pre futuristick√Ω dojem */
        .futuristic-header {
            background: linear-gradient(to right, #0d0d1a 0%, #1a1a2e 50%, #0d0d1a 100%);
            box-shadow: 0 2px 15px rgba(99, 102, 241, 0.3);
        }

        /* Vylep≈°en√Ω efekt pre karty (Futuristick√©: Viac kontrastu a ne√≥nu) */
        .card-hover {
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 2px solid #374151; /* Tmav≈°√≠, ale viditeƒæn√Ω okraj */
            background-color: #12121e; /* E≈°te tmav≈°√≠ z√°klad */
            border-radius: 0.5rem; /* Pou≈æijem rounded-lg */
        }
        .card-hover:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 0 25px rgba(99, 102, 241, 0.5), 0 0 10px rgba(52, 211, 153, 0.8); /* Kombinovan√Ω Indigo a Mint Glow */
            border-color: var(--primary-color);
        }

        /* VYLEP≈†EN√â MODERN√â TLAƒåIDL√Å (Futuristick√Ω Ne√≥n Style) */
        .modern-btn {
            @apply w-full py-4 text-center font-extrabold uppercase tracking-widest block transition duration-300 transform shadow-xl relative overflow-hidden;
            border: none;
            border-radius: 0.75rem; /* rounded-xl */
        }
        .download-btn-modern {
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%); /* Emerald Gradient */
            color: #1a1a2e; /* Dark text for contrast */
            box-shadow: 0 0 20px rgba(52, 211, 153, 0.7); /* Silnej≈°√≠ tie≈à */
        }
        .download-btn-modern:hover {
            transform: translateY(-2px) scale(1.01);
            background: linear-gradient(90deg, #059669 0%, #10b981 100%);
        }
        .paid-btn-modern {
            background: linear-gradient(90deg, #f87171 0%, #ef4444 100%); /* Red Gradient */
            color: #1a1a2e;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.7); /* Silnej≈°√≠ tie≈à */
        }
        .paid-btn-modern:hover {
            transform: translateY(-2px) scale(1.01);
            background: linear-gradient(90deg, #dc2626 0%, #f87171 100%);
        }

        /* Gradient pre Banner (Futuristick√° z√≥na) */
        #main-banner {
            background: linear-gradient(135deg, #1a1a2e, #0d0d1a);
            border-left: 5px solid var(--primary-color);
            box-shadow: 0 0 50px rgba(99, 102, 241, 0.1);
        }
        
        /* CSS pre animovan√Ω kruh (Welcome Screen & Redirect) */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        /* Dynamick√Ω Progress Bar (Ne√≥n efekt) */
        #download-progress-bar {
            height: 100%;
            transition: width 0.1s linear; /* Hlad≈°√≠ pohyb */
            background-color: var(--accent-color);
            box-shadow: 0 0 15px var(--accent-color);
        }
        
        /* ≈†t√Ωl pre vybran√Ω skin pri registr√°cii */
        .skin-option {
            transition: all 0.3s;
            cursor: pointer;
            border: 3px solid transparent;
        }
        .skin-option.selected {
            border-color: var(--accent-color);
            box-shadow: 0 0 15px rgba(52, 211, 153, 0.8);
            transform: scale(1.05);
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Navigaƒçn√Ω Panel (Header) -->
    <header class="sticky top-0 z-50 futuristic-header border-b border-indigo-900">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center py-4">
            <!-- Logo / N√°zov Port√°lu -->
            <h1 class="text-3xl font-black tracking-wider text-indigo-400">
                <span class="text-green-400">NEXUS</span> DOWNLOADS<span class="text-lg font-medium text-gray-500 ml-1">PRO</span>
            </h1>

            <!-- Prihl√°senie / Profil Tlaƒçidlo -->
            <button id="auth-btn" class="px-5 py-2 bg-indigo-600 text-white font-semibold rounded-full shadow-lg shadow-indigo-600/50 hover:bg-indigo-500 transition duration-300 transform hover:scale-105" onclick="openAuthModal('login')">
                Prihl√°si≈• sa / Register
            </button>
        </div>
    </header>

    <!-- Hlavn√Ω Obsah - Katal√≥g Hier -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">

        <!-- Banner / √övodn√° Spr√°va -->
        <div id="main-banner" class="p-8 sm:p-10 rounded-xl shadow-2xl mb-16">
            <h2 class="text-5xl font-extrabold mb-3 text-white tracking-tight">Vitajte, Hr√°ƒç.</h2>
            <p id="welcome-message" class="text-indigo-300 text-xl font-light">
                Najv√§ƒç≈°ia kni≈ænica overen√Ωch hern√Ωch s√∫borov pre **Android, iOS a PC**. Stiahnite si hru priamo zo zdroja.
            </p>
        </div>

        <!-- Sekcia Odpor√∫ƒçan√Ωch Hier -->
        <section id="featured-games" class="mb-12">
            <h3 class="text-3xl font-bold mb-10 border-l-4 border-green-400 pl-4 text-gray-200">
                <span class="text-green-400">üöÄ</span> Odpor√∫ƒçan√© & Najs≈•ahovanej≈°ie
            </h3>
            
            <div id="game-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <!-- Miesto pre Karty Hier -->
            </div>
        </section>

    </main>

    <!-- P√§tiƒçka -->
    <footer class="bg-gray-900 border-t border-gray-700 mt-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-gray-500">
            <p class="text-sm">&copy; 2025 NEXUS Mobile Pro. V≈°etky pr√°va vyhraden√©.</p>
            <p class="text-xs mt-1 opacity-70">Upozornenie: Simulovan√© s≈•ahovanie vedie k presmerovaniu na ofici√°lny obchod (Google Play / Epic Games / Roblox).</p>
        </div>
    </footer>

    <!-- MODAL PRE PRIHL√ÅSENIE / REGISTR√ÅCIU -->
    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center hidden" onclick="closeAuthModal()">
        <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-lg mx-4 p-8 relative border border-indigo-700" onclick="event.stopPropagation()">
            <button class="absolute top-4 right-4 text-gray-400 hover:text-white" onclick="closeAuthModal()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            
            <!-- TABS pre prep√≠nanie pohƒæadov -->
            <div class="flex mb-6 border-b border-indigo-700">
                <button id="tab-login" class="px-4 py-2 text-lg font-bold transition duration-300 text-indigo-300 border-b-2 border-green-400" onclick="showAuthView('login')">Prihl√°senie</button>
                <button id="tab-register" class="ml-4 px-4 py-2 text-lg font-bold transition duration-300 text-gray-400 border-b-2 border-transparent" onclick="showAuthView('register')">Registr√°cia</button>
            </div>
            
            <!-- 1. LOGIN VIEW (jednoduch√© prihl√°senie) -->
            <div id="login-view" class="auth-view">
                <h3 class="text-2xl font-bold mb-4 text-indigo-400">Prihl√°ste sa pomocou svojej prez√Ωvky</h3>
                <p class="text-gray-400 mb-5 text-sm">Zadajte svoju prez√Ωvku. Ak u≈æ existuje, automaticky sa prihl√°site.</p>
                <form onsubmit="handleLogin(event)">
                    <input type="text" id="login-nickname" class="w-full p-3 mb-4 bg-gray-700 rounded-lg border border-gray-600 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Zadajte svoju prez√Ωvku" required>
                    <button type="submit" class="w-full py-3 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg transition duration-300 shadow-lg shadow-green-600/30">
                        Prihl√°si≈• sa
                    </button>
                </form>
            </div>
            
            <!-- 2. REGISTER VIEW (komplexn√° registr√°cia s v√Ωberom profilu) -->
            <div id="register-view" class="auth-view hidden">
                <h3 class="text-2xl font-bold mb-4 text-indigo-400">Vytvorte si svoj NEXUS Profil</h3>
                <form onsubmit="handleRegistration(event)">
                    <input type="text" id="reg-nickname" class="w-full p-3 mb-4 bg-gray-700 rounded-lg border border-gray-600 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Prez√Ωvka (min. 3 znaky)" required>
                    
                    <p class="text-gray-400 mb-3 font-semibold">Vyberte si svoj ≈°t√Ωl profilu (Skin):</p>
                    <div id="skin-selection" class="flex justify-around mb-6">
                        <div class="text-center skin-option selected rounded-xl p-3 bg-gray-900" onclick="selectSkin('cyber')">
                            <span class="text-4xl block">‚öõÔ∏è</span>
                            <span class="text-xs">Cyber</span>
                        </div>
                        <div class="text-center skin-option rounded-xl p-3 bg-gray-900" onclick="selectSkin('fire')">
                            <span class="text-4xl block">üî•</span>
                            <span class="text-xs">Fire</span>
                        </div>
                        <div class="text-center skin-option rounded-xl p-3 bg-gray-900" onclick="selectSkin('water')">
                            <span class="text-4xl block">üíß</span>
                            <span class="text-xs">Water</span>
                        </div>
                        <div class="text-center skin-option rounded-xl p-3 bg-gray-900" onclick="selectSkin('ice')">
                            <span class="text-4xl block">‚ùÑÔ∏è</span>
                            <span class="text-xs">Ice</span>
                        </div>
                    </div>

                    <p class="text-gray-400 mb-3 font-semibold">Obƒæ√∫ben√© ≈æ√°nre (min. 1):</p>
                    <div id="genre-selection" class="flex flex-wrap gap-2 mb-6">
                        <label class="inline-flex items-center text-sm bg-gray-700 px-3 py-1 rounded-full cursor-pointer hover:bg-gray-600">
                            <input type="checkbox" name="genre" value="FPS" class="form-checkbox text-indigo-500 border-gray-600 focus:ring-indigo-500" checked>
                            <span class="ml-2">FPS</span>
                        </label>
                        <label class="inline-flex items-center text-sm bg-gray-700 px-3 py-1 rounded-full cursor-pointer hover:bg-gray-600">
                            <input type="checkbox" name="genre" value="RPG" class="form-checkbox text-indigo-500 border-gray-600 focus:ring-indigo-500">
                            <span class="ml-2">RPG</span>
                        </label>
                        <label class="inline-flex items-center text-sm bg-gray-700 px-3 py-1 rounded-full cursor-pointer hover:bg-gray-600">
                            <input type="checkbox" name="genre" value="Strategy" class="form-checkbox text-indigo-500 border-gray-600 focus:ring-indigo-500">
                            <span class="ml-2">Strat√©gia</span>
                        </label>
                        <label class="inline-flex items-center text-sm bg-gray-700 px-3 py-1 rounded-full cursor-pointer hover:bg-gray-600">
                            <input type="checkbox" name="genre" value="Adventure" class="form-checkbox text-indigo-500 border-gray-600 focus:ring-indigo-500">
                            <span class="ml-2">Adventure</span>
                        </label>
                    </div>

                    <button type="submit" class="w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-lg transition duration-300 shadow-lg shadow-indigo-600/30">
                        Vytvori≈• Profil a Registrova≈•
                    </button>
                </form>
            </div>
            
            <!-- 3. LOADING VIEW (po registr√°cii) -->
            <div id="loading-view" class="auth-view hidden text-center p-10">
                <h3 id="loading-welcome-text" class="text-3xl font-extrabold mb-6 text-green-400">Vitajte u n√°s, Hr√°ƒç!</h3>
                <div class="flex justify-center items-center mb-6">
                    <div class="loader"></div>
                </div>
                <p class="text-gray-400 text-lg">Pripravujeme v√°≈° personalizovan√Ω NEXUS profil...</p>
            </div>
            
            <p id="auth-error" class="text-red-400 text-center mt-3 hidden text-sm">Chyba: </p>
        </div>
    </div>
    
    <!-- NOV√ù MODAL PRE SIMUL√ÅCIU S≈§AHOVANIA -->
    <div id="download-simulation-modal" class="fixed inset-0 bg-black bg-opacity-90 z-[100] flex items-center justify-center hidden">
        <div class="bg-[#1a1a2e] rounded-xl shadow-2xl w-full max-w-xl mx-4 p-8 relative border-t-8 border-green-500 text-center" onclick="event.stopPropagation()">
            <h4 id="download-title" class="text-3xl font-extrabold mb-4 text-green-400">S≈•ahovanie: [N√°zov Hry]</h4>
            <p class="text-lg text-gray-300 mb-6">Prip√°jame sa k NEXUS distribuƒçn√Ωm serverom...</p>
            
            <!-- Progress Bar Container -->
            <div class="bg-gray-700 rounded-full h-8 mb-4 overflow-hidden shadow-inner">
                <div id="download-progress-bar" class="w-0 flex items-center justify-center h-full rounded-full text-xs font-bold text-gray-900">
                    <span id="download-percentage">0%</span>
                </div>
            </div>

            <!-- Detaily S≈•ahovania -->
            <div class="text-left bg-gray-900 p-4 rounded-lg border border-gray-700">
                <div class="flex justify-between font-mono text-sm mb-1">
                    <span class="text-gray-400">Stiahnut√© / Celkov√° Veƒækos≈•:</span>
                    <span id="download-size" class="text-white font-bold">0.00 MB / 0.00 GB</span>
                </div>
                <div class="flex justify-between font-mono text-sm">
                    <span class="text-gray-400">Aktu√°lna R√Ωchlos≈•:</span>
                    <span id="download-speed" class="text-green-400 font-bold">0.0 MB/s</span>
                </div>
                <div class="flex justify-between font-mono text-sm mt-2">
                    <span class="text-gray-400">Detekovan√© Zariadenie:</span>
                    <span id="device-type" class="text-indigo-400 font-bold">PC / Desktop</span>
                </div>
            </div>

            <button onclick="cancelDownload()" class="w-full mt-6 py-3 bg-red-600 hover:bg-red-500 text-white font-bold rounded-xl transition duration-300 shadow-lg shadow-red-600/30">
                ZRU≈†I≈§ S≈§AHOVANIE
            </button>
        </div>
    </div>
    
    <!-- MODAL PRE ZOBRAZOVANIE SPR√ÅV (N√°hrada za alert()) -->
    <div id="message-modal-container" class="fixed inset-0 bg-black bg-opacity-70 z-[110] flex items-center justify-center opacity-0 pointer-events-none" onclick="hideMessage()">
        <div id="message-modal-content" class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-sm mx-4 p-6 relative border border-indigo-500 transform scale-95 transition-all duration-300" onclick="event.stopPropagation()">
            <h4 id="message-title" class="text-2xl font-bold mb-3 text-indigo-400">Titulok</h4>
            <p id="message-text" class="text-gray-300 mb-6"></p>
            
            <button onclick="hideMessage()" class="w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-xl transition duration-300 shadow-lg">
                ZAVRIE≈§
            </button>
        </div>
    </div>


    <!-- JavaScript pre simul√°ciu, generovanie kariet a autentifik√°ciu -->
    <script>
        // --- GLOB√ÅLNY STAV ---
        let globalState = {
            isLoggedIn: false,
            userProfile: {
                nickname: null,
                skin: 'cyber', // Predvolen√Ω skin
                genres: ['FPS', 'RPG'],
                registrationDate: null // Nov√© pole pre d√°tum registr√°cie
            },
        };
        let downloadInterval = null;
        let currentDownloadUrl = null;
        let selectedSkin = 'cyber'; // Lok√°lny stav pre registraƒçn√Ω formul√°r

        // --- KON≈†TANTY PRE HRY ---
        const PAID_GAME_TITLE = 'Cursed Hiding'; 
        const MB_TO_BYTES = 1048576; // 1 MB = 1024 * 1024 bytes
        const GB_TO_BYTES = 1073741824; // 1 GB = 1024 * 1024 * 1024 bytes
        
        // R√Ωchlosti v MB/s (dynamick√© nastavenie pre simul√°ciu)
        const DOWNLOAD_SPEEDS = {
            MOBILE: { MIN: 35, MAX: 50 }, // R√Ωchlej≈°ie na mobile (napr. 5G/optimiz√°cia)
            PC: { MIN: 18, MAX: 28 }     // Pomal≈°ie na PC (simul√°cia be≈ænej ≈°irokop√°smovej siete)
        };
        
        const gamesData = [
            {
                title: PAID_GAME_TITLE,
                description: "Popul√°rna platen√° hra typu 'Hide and Seek'. Kliknite pre zistenie ceny a presmerovanie na obchod.",
                platform: "PC / Mobile / Roblox",
                size: "18.63 GB",
                downloadUrl: "https://www.roblox.com/games/5374495204/Cursed-Hiding-Seek", 
                iconColor: "red",
                icon: "üëª",
                isPaid: true
            },
            { 
                title: "Call of Duty: Brothers In Arms", 
                description: "Intenz√≠vna FPS vojensk√° simul√°cia in≈°pirovan√° Call of Duty. Presmerovanie na RobloX.", 
                platform: "PC / Mobile / Roblox", 
                size: "38.66 GB",
                downloadUrl: "https://www.roblox.com/games/15077189178/Call-of-Duty-Brothers-In-Arms", 
                iconColor: "blue",
                icon: "üéñÔ∏è",
                isPaid: false
            },
            { 
                title: "Fortnite", 
                description: "Glob√°lna Battle Royale PC senz√°cia! Presmerovanie do Epic Games Store.", 
                platform: "PC / Epic Games", 
                size: "99.58 GB", 
                downloadUrl: "https://store.epicgames.com/sk/p/fortnite", 
                iconColor: "red",
                icon: "üíª" 
            },
            { 
                title: "Call of Duty: Mobile", 
                description: "Klasick√Ω FPS z√°≈æitok s r√¥znymi re≈æimami pre Android/iOS. Link vedie na Google Play.", 
                platform: "Android", 
                size: "2.1 GB", 
                downloadUrl: "https://play.google.com/store/apps/details?id=com.activision.callofduty.shooter" , 
                iconColor: "indigo",
                icon: "üéÆ"
            },
            { 
                title: "Genshin Impact", 
                description: "Epick√© fantasy RPG s otvoren√Ωm svetom. Presmerovanie do obchodu Play.", 
                platform: "iOS & Android", 
                size: "20.5 GB", 
                downloadUrl: "https://play.google.com/store/apps/details?id=com.miHoYo.GenshinImpact", 
                iconColor: "red",
                icon: "üì±"
            },
            { 
                title: "Clash Royale", 
                description: "Strategick√° kartov√° hra 1v1 v re√°lnom ƒçase. Presmerovanie na Google Play.", 
                platform: "iOS & Android", 
                size: "0.25 GB", 
                downloadUrl: "https://play.google.com/store/apps/details?id=com.supercell.clashroyale", 
                iconColor: "yellow",
                icon: "üì±"
            },
        ];

        // --- POMOCN√â FUNKCIE ---
        
        // Zis≈•uje, ƒçi je zariadenie mobiln√© (pre dynamick√© r√Ωchlosti)
        function isMobileDevice() {
            return /Mobi|Android/i.test(navigator.userAgent);
        }

        // Prevod textu "XX.XX GB" na bajty
        function sizeStringToBytes(sizeString) {
            const parts = sizeString.toUpperCase().split(' ');
            const value = parseFloat(parts[0]);
            const unit = parts[1];

            if (unit === 'GB') {
                return value * GB_TO_BYTES;
            } else if (unit === 'MB') {
                return value * MB_TO_BYTES;
            }
            return value; // Vr√°ti p√¥vodn√∫ hodnotu, ak je v inej jednotke
        }

        // Form√°tovanie bajtov na ƒçitateƒæn√© MB alebo GB
        function formatBytes(bytes) {
            if (bytes >= GB_TO_BYTES) {
                return (bytes / GB_TO_BYTES).toFixed(2) + ' GB';
            } else if (bytes >= MB_TO_BYTES) {
                return (bytes / MB_TO_BYTES).toFixed(2) + ' MB';
            } else {
                return bytes.toFixed(0) + ' B';
            }
        }

        // Form√°tovanie timestamp na ƒçitateƒæn√Ω d√°tum a ƒças
        function formatDate(timestamp) {
            if (!timestamp) return 'Nezn√°my';
            const date = new Date(timestamp);
            return date.toLocaleDateString('sk-SK', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // --- MANA≈ΩMENT LOK√ÅLNEHO √öLO≈ΩISKA (AUTENTIFIK√ÅCIA) ---
        
        function getSkinIcon(skin) {
            if (skin === 'fire') return 'üî•';
            if (skin === 'water') return 'üíß';
            if (skin === 'ice') return '‚ùÑÔ∏è';
            if (skin === 'cyber') return '‚öõÔ∏è';
            return 'üë§';
        }

        function loadUserProfile() {
            const storedProfile = localStorage.getItem('userProfile');
            const authBtn = document.getElementById('auth-btn');
            const welcomeMsg = document.getElementById('welcome-message');

            if (storedProfile) {
                globalState.userProfile = JSON.parse(storedProfile);
                globalState.isLoggedIn = true;
                
                // Aktualiz√°cia tlaƒçidla prihl√°senia na profil s nov√Ωm skinom
                authBtn.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <span class="text-2xl">${getSkinIcon(globalState.userProfile.skin || 'üë§')}</span>
                        <span class="font-bold">${globalState.userProfile.nickname}</span>
                    </div>
                `;
                
                const regDateText = formatDate(globalState.userProfile.registrationDate);

                // Upraven√° spr√°va s d√°tumom registr√°cie
                authBtn.onclick = () => showMessage(
                    'Profil Hr√°ƒça', 
                    `Vitajte, ${globalState.userProfile.nickname}! Ste prihl√°sen√Ω so ≈°t√Ωlom **${globalState.userProfile.skin.toUpperCase()}**.
                    <br><br><span class="text-sm text-gray-400">Obƒæ√∫ben√© ≈æ√°nre:</span> <strong>${globalState.userProfile.genres.join(', ')}</strong>
                    <br><span class="text-sm text-gray-400">D√°tum registr√°cie:</span> <strong>${regDateText}</strong>.`,
                    () => handleLogout()
                );
                
                welcomeMsg.textContent = `Vitajte, ${globalState.userProfile.nickname}! V√°≈° **${globalState.userProfile.skin.toUpperCase()}** profil je pripraven√Ω na s≈•ahovanie.`;
                return true;
            }
            // Nastavenie pre neprihl√°sen√©ho u≈æ√≠vateƒæa
            authBtn.textContent = 'Prihl√°si≈• sa / Register';
            authBtn.onclick = () => openAuthModal('login');
            welcomeMsg.textContent = 'Najv√§ƒç≈°ia kni≈ænica overen√Ωch hern√Ωch s√∫borov pre Android, iOS a PC. Stiahnite si hru priamo zo zdroja.';
            return false;
        }
        
        function handleLogout() {
            globalState.isLoggedIn = false;
            globalState.userProfile.nickname = null;
            // Nechceme vymaza≈• cel√Ω userProfile, aby sme zachovali registrationDate, ak je to mo≈æn√©, 
            // ale pre jednoduchos≈• ho vyma≈æeme, preto≈æe sa vytvor√≠ znova pri prihl√°sen√≠
            localStorage.removeItem('userProfile'); 
            renderGameCards();
            loadUserProfile(); // Resetuje UI
            showMessage('Odhl√°senie', 'Boli ste √∫spe≈°ne odhl√°sen√Ω.');
        }

        function closeAuthModal() {
            document.getElementById('auth-modal').classList.add('hidden');
            document.getElementById('auth-error').classList.add('hidden');
        }
        
        // --- AUTENTIFIK√ÅCIA UI MANA≈ΩMENT ---

        function showAuthView(viewName) {
            const views = document.querySelectorAll('.auth-view');
            views.forEach(view => view.classList.add('hidden'));

            const tabs = document.querySelectorAll('#auth-modal button[id^="tab-"]');
            tabs.forEach(tab => {
                tab.classList.remove('border-green-400');
                tab.classList.add('border-transparent', 'text-gray-400');
            });

            document.getElementById(`${viewName}-view`).classList.remove('hidden');
            document.getElementById(`tab-${viewName}`).classList.add('border-green-400', 'text-indigo-300');
            document.getElementById(`tab-${viewName}`).classList.remove('border-transparent', 'text-gray-400');
            
            // Pri prepnut√≠ na registr√°ciu sa uist√≠me, ≈æe je vybran√Ω predvolen√Ω skin
            if (viewName === 'register') {
                selectSkin(selectedSkin); // Re-highlight current selection
            }
            
            // Skry≈• chybu pri prep√≠nan√≠
            document.getElementById('auth-error').classList.add('hidden');
            document.getElementById('auth-error').textContent = 'Chyba: ';
        }
        
        function openAuthModal(initialView = 'login') {
            document.getElementById('auth-modal').classList.remove('hidden');
            showAuthView(initialView);
        }
        
        // OPRAVEN√Å FUNKCIA: Pou≈æ√≠va ≈°tandardn√© JavaScript DOM met√≥dy namiesto jQuery `:contains()`
        function selectSkin(skin) {
            selectedSkin = skin;
            const skinOptions = document.querySelectorAll('.skin-option');
            
            skinOptions.forEach(el => {
                el.classList.remove('selected');
                
                // N√°zov skinu je v <span> s triedou 'text-xs'
                const skinNameSpan = el.querySelector('.text-xs');
                
                // Porovn√°vame text (napr. "Cyber") s aktu√°lnym skin (napr. "cyber")
                if (skinNameSpan && skinNameSpan.textContent.toLowerCase() === skin.toLowerCase()) {
                    el.classList.add('selected');
                }
            });
        }

        function displayError(message) {
            const errorEl = document.getElementById('auth-error');
            errorEl.textContent = `Chyba: ${message}`;
            errorEl.classList.remove('hidden');
        }

        // --- HANDLERY FORIEM ---

        // Pre existuj√∫cich pou≈æ√≠vateƒæov (jednoduch√Ω login)
        function handleLogin(event) {
            event.preventDefault();
            const nickname = document.getElementById('login-nickname').value.trim();
            
            if (nickname.length < 3) {
                displayError("Prez√Ωvka mus√≠ ma≈• aspo≈à 3 znaky.");
                return;
            }

            // Simul√°cia prihl√°senia (pou≈æ√≠vame localStorage)
            let profile = JSON.parse(localStorage.getItem('userProfile'));

            if (profile && profile.nickname !== nickname) {
                // Ak existuje in√Ω profil, ale prihlasujeme sa pod nov√Ωm nickom,
                // m√¥≈æeme simulova≈•, ≈æe nov√Ω nick je registrovan√Ω anonymne.
                // Pre jednoduchos≈• budeme simulova≈•, ≈æe ho vytvor√≠me, ak neexistuje
                // (rovnako ako p√¥vodn√Ω k√≥d).
                
                // Zjednodu≈°en√° verzia: Ak sa prihlasujem pod nov√Ωm menom, prep√≠≈°eme profil
                // a nastav√≠me defaultn√© hodnoty.
                if (!profile.registrationDate) {
                    profile = {
                        nickname: nickname,
                        skin: 'cyber', 
                        genres: ['FPS', 'RPG'],
                        registrationDate: Date.now()
                    };
                } else {
                    profile.nickname = nickname;
                }
            } else if (!profile) {
                 // Nov√° registr√°cia cez login formul√°r (s predvolen√Ωmi hodnotami)
                 profile = {
                    nickname: nickname,
                    skin: 'cyber', 
                    genres: ['FPS', 'RPG'],
                    registrationDate: Date.now()
                };
            }
            
            // Dokonƒçenie prihl√°senia
            globalState.userProfile = profile;
            globalState.isLoggedIn = true;
            localStorage.setItem('userProfile', JSON.stringify(profile));
            
            closeAuthModal();
            loadUserProfile(); 
            showMessage('Prihl√°senie √öspe≈°n√©', `Vitajte sp√§≈•, ${nickname}!`);
            renderGameCards();
        }

        // Pre nov√Ωch pou≈æ√≠vateƒæov (detailn√° registr√°cia)
        function handleRegistration(event) {
            event.preventDefault();
            const nickname = document.getElementById('reg-nickname').value.trim();
            const checkedGenres = document.querySelectorAll('#genre-selection input:checked');
            const genres = Array.from(checkedGenres).map(cb => cb.value);

            if (nickname.length < 3) {
                displayError("Prez√Ωvka mus√≠ ma≈• aspo≈à 3 znaky.");
                return;
            }
            if (genres.length === 0) {
                displayError("Pros√≠m, vyberte aspo≈à jeden obƒæ√∫ben√Ω ≈æ√°ner.");
                return;
            }
            
            // 1. Zostavenie profilu
            const newProfile = {
                nickname: nickname,
                skin: selectedSkin,
                genres: genres,
                registrationDate: Date.now()
            };
            
            // 2. Simul√°cia naƒç√≠tavania (Koliesko)
            document.getElementById('loading-welcome-text').textContent = `Vitajte u n√°s, ${nickname}!`;
            showAuthView('loading');
            document.getElementById('auth-modal').onclick = () => { /* Zak√°za≈• zatvorenie poƒças naƒç√≠tavania */ };
            
            // 3. Po 2 sekund√°ch dokonƒç√≠me registr√°ciu
            setTimeout(() => {
                globalState.userProfile = newProfile;
                globalState.isLoggedIn = true;
                localStorage.setItem('userProfile', JSON.stringify(newProfile));
                
                closeAuthModal();
                loadUserProfile(); 
                showMessage('Registr√°cia Dokonƒçen√°', `V√°≈° **${selectedSkin.toUpperCase()}** profil bol √∫spe≈°ne vytvoren√Ω!`);
                renderGameCards();
                
                // Znovu povoli≈• zatv√°ranie modalu kliknut√≠m von
                document.getElementById('auth-modal').onclick = closeAuthModal;
            }, 2000); 
        }

        // --- N√ÅHRADA ZA ALERT() ---
        
        function showMessage(title, message, callback = null) {
            const container = document.getElementById('message-modal-container');
            const content = document.getElementById('message-modal-content');
            document.getElementById('message-title').textContent = title;
            // Pou≈æitie innerHTML pre podporu HTML znaƒçiek (napr. <br>) vo vn√∫tri spr√°vy
            document.getElementById('message-text').innerHTML = message; 
            
            const okButton = document.querySelector('#message-modal-content button');
            okButton.onclick = () => {
                hideMessage();
                if (callback) callback();
            };

            container.classList.remove('opacity-0', 'pointer-events-none');
            content.classList.remove('scale-95');
        }

        function hideMessage() {
            const container = document.getElementById('message-modal-container');
            const content = document.getElementById('message-modal-content');
            content.classList.add('scale-95');
            container.classList.add('opacity-0');
            
            setTimeout(() => {
                container.classList.add('pointer-events-none');
            }, 300);
        }

        // --- MANA≈ΩMENT S≈§AHOVANIA (SIMUL√ÅCIA) ---
        
        function startDownloadSimulation(gameData) {
            const modal = document.getElementById('download-simulation-modal');
            modal.classList.remove('hidden');

            document.getElementById('download-title').textContent = `S≈•ahovanie: ${gameData.title}`;
            
            // Kon≈°tanty pre simul√°ciu
            const totalBytes = sizeStringToBytes(gameData.size);
            let downloadedBytes = 0;
            const intervalTime = 100; // Interval aktualiz√°cie v ms
            
            // Urƒçenie r√Ωchlostn√©ho limitu podƒæa zariadenia
            const isMobile = isMobileDevice();
            const speedConfig = isMobile ? DOWNLOAD_SPEEDS.MOBILE : DOWNLOAD_SPEEDS.PC;
            document.getElementById('device-type').textContent = isMobile ? 'Mobil / Tablet' : 'PC / Desktop';
            
            let currentSpeedMBps = speedConfig.MIN;
            
            // Elementy UI
            const progressBar = document.getElementById('download-progress-bar');
            const percentageText = document.getElementById('download-percentage');
            const sizeText = document.getElementById('download-size');
            const speedText = document.getElementById('download-speed');
            
            currentDownloadUrl = gameData.downloadUrl; // Ulo≈æ√≠ URL pre presmerovanie po dokonƒçen√≠

            // Hlavn√Ω cyklus s≈•ahovania
            downloadInterval = setInterval(() => {
                
                // 1. N√°hodn√° fluktu√°cia r√Ωchlosti (realistickej≈°√≠ internet)
                const fluctuation = (Math.random() - 0.5) * 2; // -1.0 to 1.0
                currentSpeedMBps = Math.max(speedConfig.MIN, Math.min(speedConfig.MAX, currentSpeedMBps + fluctuation));
                
                // 2. V√Ωpoƒçet stiahnut√Ωch bajtov v tomto kroku
                // bytes_per_tick = speed_MBps * MB_TO_BYTES * (intervalTime / 1000 seconds)
                const bytesDownloadedInStep = currentSpeedMBps * MB_TO_BYTES * (intervalTime / 1000);
                
                downloadedBytes += bytesDownloadedInStep;

                // 3. Kontrola dokonƒçenia
                if (downloadedBytes >= totalBytes) {
                    clearInterval(downloadInterval);
                    downloadedBytes = totalBytes; // Nastav√≠ na 100% presne
                    
                    // Fin√°lna aktualiz√°cia UI
                    const percentage = 100;
                    progressBar.style.width = percentage + '%';
                    percentageText.textContent = `${percentage.toFixed(0)}% DOKONƒåEN√â`;
                    speedText.textContent = '0.0 MB/s (Hotovo)';
                    sizeText.textContent = `${formatBytes(downloadedBytes)} / ${formatBytes(totalBytes)}`;
                    
                    // Dokonƒçenie a presmerovanie
                    setTimeout(() => {
                        modal.classList.add('hidden');
                        showMessage('S≈•ahovanie Dokonƒçen√©', `Hra '${gameData.title}' bola simulovane stiahnut√°! Budete presmerovan√Ω do ofici√°lneho obchodu.`, () => {
                             window.open(gameData.downloadUrl, '_blank');
                        });
                    }, 1000); 
                    
                } else {
                    // 4. Aktualiz√°cia UI
                    const percentage = (downloadedBytes / totalBytes) * 100;
                    progressBar.style.width = percentage + '%';
                    percentageText.textContent = `${percentage.toFixed(1)}%`;
                    
                    sizeText.textContent = `${formatBytes(downloadedBytes)} / ${formatBytes(totalBytes)}`;
                    speedText.textContent = `${currentSpeedMBps.toFixed(2)} MB/s`;
                }

            }, intervalTime);
        }

        function cancelDownload() {
            if (downloadInterval) {
                clearInterval(downloadInterval);
                downloadInterval = null;
                currentDownloadUrl = null;
            }
            document.getElementById('download-simulation-modal').classList.add('hidden');
            showMessage('S≈•ahovanie Zru≈°en√©', 'S≈•ahovanie bolo preru≈°en√©. M√¥≈æete zaƒça≈• s≈•ahova≈• znova.');
        }
        
        // Hlavn√° akcia po kliknut√≠ na Stiahnu≈•/Hra≈•
        function handleGameAction(gameData) {
            if (!globalState.isLoggedIn) {
                showMessage('Chyba Pr√≠stupu', 'Pre spustenie s≈•ahovania sa mus√≠te najprv prihl√°si≈• alebo zaregistrova≈•.');
                openAuthModal('register');
                return;
            }
            
            if (gameData.isPaid) {
                // Pre platen√∫ hru len zobraz√≠me info a spust√≠me simul√°ciu
                showMessage('Platen√° Hra', `Hra '${gameData.title}' je platen√°. Pre spustenie in≈°tal√°cie kliknite 'OK' a zaƒçnite simulovan√© s≈•ahovanie.`);
            }

            // Spustenie komplexnej simul√°cie s≈•ahovania
            startDownloadSimulation(gameData);
        }


        // --- GENER√ÅCIA A RENDERING KARIET HIER ---

        function renderGameCards() {
            const container = document.getElementById('game-grid');
            container.innerHTML = '';
            
            gamesData.forEach(game => {
                let buttonHtml;
                // JSON.stringify je potrebn√© pre prenos objektu do inline JS handleru
                const gameDataJson = JSON.stringify(game).replace(/"/g, '&quot;');
                let buttonHandler = `handleGameAction(${gameDataJson})`;

                if (game.isPaid) {
                    buttonHtml = `
                        <button onclick="${buttonHandler}" class="modern-btn paid-btn-modern">
                            üõí K√öPI≈§ A HRA≈§ (${game.size})
                        </button>
                    `;
                } else {
                    buttonHtml = `
                        <button onclick="${buttonHandler}" class="modern-btn download-btn-modern">
                            ‚Üì STIAHNU≈§ A HRA≈§ (${game.size})
                        </button>
                    `;
                }

                const card = document.createElement('div');
                // Dynamick√° farba pre platformu
                const platformColorClass = game.iconColor === 'yellow' ? 'text-yellow-400' : 
                                           game.iconColor === 'red' ? 'text-red-400' : 
                                           game.iconColor === 'blue' ? 'text-blue-400' : 'text-indigo-400';

                card.className = 'card-hover rounded-lg shadow-xl p-6 flex flex-col justify-between';
                card.innerHTML = `
                    <div>
                        <!-- Ikona Hry a Platforma -->
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-5xl">${game.icon}</span>
                            <span class="text-xs font-semibold uppercase px-3 py-1 bg-gray-700 ${platformColorClass} rounded-full shadow-inner">${game.platform}</span>
                        </div>
                        
                        <!-- N√°zov a Popis -->
                        <h4 class="text-xl font-bold mb-2 text-white">${game.title}</h4>
                        <p class="text-gray-400 text-sm mb-6">${game.description}</p>
                    </div>
                    
                    <!-- Akƒçn√© Tlaƒçidl√° -->
                    <div class="mt-auto">
                        ${buttonHtml}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // --- INICIALIZ√ÅCIA ---

        window.onload = function() {
            loadUserProfile();
            renderGameCards();
            
            // Nastav√≠me predvolen√Ω selectedSkin pri naƒç√≠tan√≠ (pre registraƒçn√Ω formul√°r)
            selectSkin('cyber');
        };

    </script>
</body>
</html>










